# Introduction

This report aims to model and forecast the closing prices of JPMorgan Chase & Co. preferred shares (JPM-PD) from January 2021 to December 2024 using seasonal ARIMA models in R. The analysis involves data collection, stationarity testing, model comparison, forecasting, and result visualization.

# Data Collection

```{r load-packages, message=FALSE}
library(quantmod)
library(forecast)
library(tseries)
library(TSA)
library(lubridate)
library(dplyr)
library(openxlsx)
library(ggplot2)
```

Retrieve monthly closing price data from Yahoo Finance:

```{r data-retrieval}
getSymbols("JPM-PD", src = "yahoo", from = "2021-01-01", to = "2024-12-31", periodicity = "monthly")
data <- `JPM-PD`
close_xts <- Cl(data)
df <- data.frame(Date = index(close_xts), Close = coredata(close_xts))
ts <- ts(df$JPM.PD.Close, start = c(2021, 1), frequency = 12)
```

# Exploratory Data Analysis

```{r plot-time-series}
plot(ts, main = "Time Series of Closing Prices", ylab = "Closing Price", xlab = "Year")
```

```{r plot-by-year}
df_ts <- data.frame(
  Date = seq(as.Date("2021-01-01"), by = "month", length.out = length(ts)),
  Close = as.numeric(ts)
)
df_ts$Month <- month(df_ts$Date, label = TRUE, abbr = TRUE)
df_ts$Year <- factor(year(df_ts$Date))

ggplot(df_ts, aes(x = Month, y = Close, color = Year, group = Year)) +
  geom_line(size = 1) +
  labs(title = "Comparison of Closing Prices by Year (Monthly)",
       x = "Month", y = "Closing Price") +
  theme_minimal()
```

# Stationarity Test

```{r adf-test}
adf.test(ts, alternative = "stationary")
```
The Augmented Dickey-Fuller test result shows a p-value of 0.7302 (> 0.05), indicating that the time series is non-stationary at level and requires differencing.

```{r differencing}
ts_diff <- diff(ts, differences = 1)
adf.test(ts_diff, alternative = "stationary")
```
After first-order differencing, the Augmented Dickey-Fuller test yields a p-value of 0.01 (< 0.05), indicating that the differenced time series is now stationary and suitable for ARIMA modeling.


# ACF, PACF, and EACF

```{r acf-pacf-eacf}
tsdisplay(ts_diff)
eacf(ts_diff, ar.max = 8, ma.max = 8)
```

# Model Fitting

Based on the patterns observed in the ACF, PACF, and EACF plots of the differenced series, several candidate ARIMA models were specified for comparison. The models include combinations of autoregressive (AR), moving average (MA), and seasonal components to capture the structure suggested by the correlation diagnostics.

```{r model-fitting}
m1 <- Arima(ts, order = c(1, 1, 1), seasonal = c(1, 0, 0))
m2 <- Arima(ts, order = c(1, 1, 0), seasonal = c(1, 0, 0))
m3 <- Arima(ts, order = c(2, 0, 0), seasonal = c(1, 1, 0)) # Selected
m4 <- Arima(ts, order = c(1, 0, 2), seasonal = c(1, 1, 0))
m5 <- Arima(ts, order = c(3, 0, 1), seasonal = c(1, 1, 0))
```

# Model Coefficient Analysis

To evaluate and interpret the estimated parameters of each ARIMA model, a custom function `printstatarima()` was created. This function displays:

- Estimated coefficients
- Standard errors (s.e.)
- t-statistics
- p-values (sign.)

The p-values help determine the statistical significance of each parameter in the model. Models with more significant coefficients (p < 0.05) are generally preferred.

```{r model-coefficients}
# Define and use printstatarima to summarize coefficients
printstatarima <- function(x, digits = 4, se = TRUE) {
  if (length(x$coef) > 0) {
    cat("\nCoefficients:\n")
    coef <- round(x$coef, digits = digits)
    if (se && nrow(x$var.coef)) {
      ses <- rep(0, length(coef))
      ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits = digits)
      coef <- matrix(coef, 1, dimnames = list(NULL, names(coef)))
      coef <- rbind(coef, s.e. = ses)
      statt <- coef[1, ] / ses
      pval <- 2 * pt(abs(statt), df = length(x$residuals) - 1, lower.tail = FALSE)
      coef <- rbind(coef, t = round(statt, digits = digits), sign. = round(pval, digits = digits))
      coef <- t(coef)
    }
    print.default(coef, print.gap = 2)
  }
}

printstatarima(m1)
printstatarima(m2)
printstatarima(m3)
printstatarima(m4)
printstatarima(m5)
```
Among the five ARIMA models evaluated, Model m3: ARIMA(2,0,0)(1,1,0)[12] was selected as the best fit. This choice was based on the statistical significance of its parameters: all three coefficients—AR(1), AR(2), and SAR(1)—have p-values below 0.05, indicating that each term contributes meaningfully to the model. In contrast, the other models included one or more parameters with high p-values, suggesting less reliable estimation or overfitting.

Therefore, Model m3 is considered both parsimonious and statistically robust for forecasting purposes.

```{r model-summaries}
summary(m3)
```
The training set error metrics indicate acceptable performance:
* RMSE: 0.6510
* MAE: 0.4577
* MAPE: 1.85%
* MASE: 0.3855

These values suggest that the model has low prediction error and is well-calibrated. Furthermore, the first-lag autocorrelation of residuals (ACF1 = 0.058) is close to zero, implying no significant autocorrelation remains — a sign of model adequacy.

# Forecasting

```{r forecasting}
forecasted_values <- forecast(m3, h = 12)
autoplot(forecasted_values) +
  ggtitle("Forecast of Closing Prices JPM-PD for January - December 2025") +
  xlab("Time") +
  ylab("Closing Prices") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

# Forecast Table

```{r forecast-table}
forecast_dates <- seq(tail(index(close_xts), 1) + months(1), by = "month", length.out = 12)

forecast_table <- data.frame(
  Period = forecast_dates,
  Forecast = as.numeric(forecasted_values$mean),
  Lower95 = as.numeric(forecasted_values$lower[, "95%"]),
  Upper95 = as.numeric(forecasted_values$upper[, "95%"])
)

forecast_table
```

# Export Results

```{r export-excel}
write.xlsx(forecast_table, file = "JPM-PD - Forecast (2025).xlsx")
```

# Conclusion

The ARIMA(2,0,0)(1,1,0)[12] model was selected based on model diagnostics.  
The forecasted JPM-PD stock prices for 2025 show a relatively stable pattern, with confidence intervals reflecting moderate uncertainty.
